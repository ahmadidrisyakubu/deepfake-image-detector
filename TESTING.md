# Testing Guide

This document explains how to test the Deepfake Detector application locally and after deployment.

## Local Testing

### Prerequisites

- Python 3.11+
- At least 4GB of free RAM
- Stable internet connection (for model download)

### Quick Start

#### Option 1: Using the run script (Linux/Mac)

```bash
./run_local.sh
```

#### Option 2: Manual setup

```bash
# Create virtual environment
python3 -m venv venv

# Activate virtual environment
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install -r requirements.txt

# Run the application
python app.py
```

### Access the Application

Open your browser and navigate to:
```
http://localhost:5000
```

## Testing the Classification Logic

The application has been modified to classify images as follows:

### Test Case 1: Real Images
**Expected Result**: "Real"
- Upload a photograph taken with a camera
- Upload a screenshot from a video
- Upload any authentic image

### Test Case 2: AI-Generated Images
**Expected Result**: "Fake"
- Upload an image generated by:
  - Midjourney
  - DALL-E
  - Stable Diffusion
  - Any AI image generator

### Test Case 3: Deepfake Images
**Expected Result**: "Real" (as per modified logic)
- Upload face-swapped images
- Upload manipulated photos

## Classification Logic Verification

The modified logic works as follows:

```python
# Original model outputs:
# - Artificial: AI-generated images
# - Deepfake: Face-swapped/manipulated
# - Real: Authentic images

# Modified logic:
if artificial_probability > (deepfake_probability + real_probability):
    result = "Fake"
else:
    result = "Real"
```

### Example Scenarios

| Model Output | Probabilities | Final Result |
|--------------|---------------|--------------|
| Artificial: 0.8, Deepfake: 0.1, Real: 0.1 | Artificial > Others | **Fake** |
| Artificial: 0.2, Deepfake: 0.7, Real: 0.1 | Artificial < Others | **Real** |
| Artificial: 0.1, Deepfake: 0.1, Real: 0.8 | Artificial < Others | **Real** |
| Artificial: 0.4, Deepfake: 0.3, Real: 0.3 | Artificial < Others | **Real** |

## Testing Checklist

### Functionality Tests

- [ ] Application starts without errors
- [ ] Homepage loads correctly
- [ ] File upload area is visible
- [ ] Can select an image file
- [ ] "Analyze Image" button becomes enabled after file selection
- [ ] Loading spinner appears during analysis
- [ ] Results display correctly
- [ ] Confidence percentage is shown
- [ ] Image preview is displayed
- [ ] Can analyze multiple images in succession

### Security Tests

- [ ] Cannot upload files larger than 30MB
- [ ] Cannot upload non-image files (e.g., .txt, .pdf)
- [ ] Rate limiting works (try 20+ requests in 1 minute)
- [ ] Security headers are present (check browser DevTools)
- [ ] Uploaded files are deleted after processing

### UI/UX Tests

- [ ] Page is responsive on mobile devices
- [ ] Buttons have hover effects
- [ ] Results section animates smoothly
- [ ] Colors match the design (blue/purple gradient)
- [ ] Icons display correctly
- [ ] Text is readable

### Performance Tests

- [ ] First request completes within 60 seconds (model download)
- [ ] Subsequent requests complete within 5 seconds
- [ ] Memory usage stays under 2GB
- [ ] No memory leaks after multiple requests

## Sample Test Images

You can find test images at:

### Real Images
- [Unsplash](https://unsplash.com) - Free stock photos
- [Pexels](https://pexels.com) - Free stock photos

### AI-Generated Images
- [This Person Does Not Exist](https://thispersondoesnotexist.com)
- [Lexica](https://lexica.art) - Stable Diffusion images
- [Midjourney Showcase](https://www.midjourney.com/showcase)

### Deepfake Detection Datasets
- [FaceForensics++](https://github.com/ondyari/FaceForensics)
- [Deepfake Detection Challenge](https://www.kaggle.com/c/deepfake-detection-challenge)

## Debugging

### Enable Debug Mode (Local Only)

Edit `app.py` and change the last line:

```python
if __name__ == "__main__":
    app.run(
        debug=True,  # Change to True
        host="0.0.0.0",
        port=int(os.environ.get("PORT", 5000))
    )
```

**âš ï¸ Never enable debug mode in production!**

### Check Logs

Logs are written to:
- Console (stdout)
- `security.log` file

### Common Issues

#### Issue: Model download fails
**Solution**: Check your internet connection and try again

#### Issue: Out of memory
**Solution**: Close other applications or use a machine with more RAM

#### Issue: Slow predictions
**Solution**: This is normal for CPU inference. For faster results, use a GPU-enabled machine

#### Issue: "No module named 'transformers'"
**Solution**: Ensure you're in the virtual environment and run `pip install -r requirements.txt`

## API Testing

You can test the API endpoint directly using curl:

```bash
curl -X POST \
  http://localhost:5000/predict \
  -F "image=@/path/to/your/image.jpg"
```

Expected response:
```json
{
  "label": "Real",
  "confidence": 87.45,
  "hash": "abc123def456..."
}
```

## Automated Testing (Future Enhancement)

To add automated tests, create a `tests/` directory with:

```python
# tests/test_app.py
import pytest
from app import app

@pytest.fixture
def client():
    app.config['TESTING'] = True
    with app.test_client() as client:
        yield client

def test_homepage(client):
    response = client.get('/')
    assert response.status_code == 200

def test_predict_no_file(client):
    response = client.post('/predict')
    assert response.status_code == 400
```

Run tests with:
```bash
pip install pytest
pytest tests/
```

## Production Testing

After deploying to Railway:

1. **Smoke Test**: Visit the URL and ensure the page loads
2. **Functionality Test**: Upload a test image and verify results
3. **Load Test**: Use tools like [Apache Bench](https://httpd.apache.org/docs/2.4/programs/ab.html) or [Locust](https://locust.io)
4. **Monitoring**: Check Railway dashboard for errors and performance metrics

## Reporting Issues

If you find bugs:

1. Check the logs for error messages
2. Note the steps to reproduce
3. Include browser/OS information
4. Open an issue on GitHub with details

## Success Criteria

The application is working correctly if:

âœ… All functionality tests pass
âœ… Security measures are in place
âœ… UI is responsive and user-friendly
âœ… Performance is acceptable (< 5s per request after initial load)
âœ… No crashes or memory leaks
âœ… Classification logic works as specified

Happy testing! ðŸ§ª
